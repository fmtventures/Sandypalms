<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandy Palms Strategic Business Plan | Interactive Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            sand: '#F5F2EA',      // Warm background
                            beige: '#E6E2D6',     // Secondary background
                            teal: '#2A9D8F',      // Primary Action
                            darkteal: '#20756B',  // Hover state
                            navy: '#264653',      // Text / Dark accents
                            gold: '#E9C46A',      // Highlight
                            coral: '#E76F51',     // Alert
                        }
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Inter"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F5F2EA; color: #264653; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Playfair Display', serif; }
        
        .chart-container {
            position: relative; width: 100%; max-width: 600px;
            margin-left: auto; margin-right: auto; height: 320px; max-height: 400px;
        }

        /* Tab Styling */
        .tab-btn {
            padding: 0.75rem 1rem; font-size: 0.875rem; font-weight: 500; color: #6B7280;
            transition: all 0.2s; border-bottom-width: 4px; border-color: transparent; white-space: nowrap;
        }
        .tab-btn:hover { color: #2A9D8F; }
        .tab-btn.active { color: #264653; border-color: #2A9D8F; font-weight: 700; background-color: white; }
        
        /* Inputs */
        .input-clean {
            width: 100%; background-color: #F9FAFB; border: 1px solid #D1D5DB;
            border-radius: 0.25rem; padding: 0.25rem 0.5rem; text-align: right;
            font-weight: 700; color: #264653; font-size: 0.9rem; transition: all 0.2s;
        }
        .input-clean:focus { outline: none; border-color: #2A9D8F; background-color: white; }
        
        .table-input-clean {
             width: 4rem; background-color: white; border: 1px solid #E5E7EB;
             border-radius: 0.25rem; padding: 0.25rem; text-align: center;
             font-weight: 700; color: #2A9D8F; font-size: 0.75rem;
        }

        /* Drag & Drop Styles */
        .step-card { transition: transform 0.2s, box-shadow 0.2s; position: relative; cursor: grab; }
        .step-card:active { cursor: grabbing; }
        .step-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-color: #2A9D8F; }
        .step-card.dragging { opacity: 0.5; border: 2px dashed #2A9D8F; background-color: #f0fdfa; }
        .delete-btn {
            position: absolute; top: -10px; right: -10px; width: 24px; height: 24px;
            border-radius: 50%; background-color: #EF4444; color: white; display: flex;
            align-items: center; justify-content: center; font-size: 16px; cursor: pointer;
            opacity: 0; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;
        }
        .step-card:hover .delete-btn { opacity: 1; top: -12px; right: -12px; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Range Slider */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #2A9D8F; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #E6E2D6; border-radius: 2px;
        }

        /* Print */
        @media print {
            header, nav, footer, .no-print { display: none !important; }
            body { background-color: white; color: black; }
            .bg-brand-navy { background-color: #264653 !important; -webkit-print-color-adjust: exact; }
            .hidden { display: none !important; }
        }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white shadow-sm border-b border-brand-beige sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üå¥</span>
                <div class="flex flex-col">
                    <h1 class="text-xl font-bold tracking-tight text-brand-navy leading-none">Sandy Palms <span class="hidden sm:inline font-normal text-gray-500">| Private Equity Offering</span></h1>
                    <a href="#" class="text-xs text-brand-teal hover:underline mt-1 font-sans">sandypalmsbahamas.com</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="exportAllDataCSV()" class="hidden sm:flex items-center gap-2 bg-green-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-green-700 transition-colors no-print">
                    <span>üìä</span> Export Data (CSV)
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <section class="relative h-[400px] flex items-center justify-center overflow-hidden no-print bg-gradient-to-br from-brand-navy via-[#1f3a45] to-[#162e38]">
            <div class="relative z-10 max-w-5xl mx-auto text-center px-4 mt-4">
                <span class="inline-block bg-white/10 backdrop-blur-md text-white border border-white/30 px-4 py-1 rounded-full text-xs font-bold tracking-wide uppercase shadow-sm mb-4 font-sans">Target Acquisition: Summer 2026</span>
                <h2 class="text-3xl sm:text-5xl font-bold mb-4 leading-tight text-white drop-shadow-lg">Bahamas Investment Opportunity</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto text-center font-sans mt-8">
                    <div class="bg-black/30 p-4 rounded-xl backdrop-blur-md border border-white/20">
                        <div class="text-brand-gold text-3xl font-bold mb-1">$1.985M</div>
                        <div class="text-xs text-white/80 uppercase tracking-wider font-semibold">Acquisition Price</div>
                    </div>
                    <div class="bg-black/30 p-4 rounded-xl backdrop-blur-md border border-white/20">
                        <div class="text-brand-gold text-3xl font-bold mb-1">$3.5M</div>
                        <div class="text-xs text-white/80 uppercase tracking-wider font-semibold">Target Exit (Yr 5)</div>
                    </div>
                    <div class="bg-black/30 p-4 rounded-xl backdrop-blur-md border border-white/20">
                        <div class="text-brand-gold text-3xl font-bold mb-1">60%</div>
                        <div class="text-xs text-white/80 uppercase tracking-wider font-semibold">Vacancy Rate Target</div>
                    </div>
                    <div class="bg-black/30 p-4 rounded-xl backdrop-blur-md border border-white/20">
                        <div class="text-brand-gold text-3xl font-bold mb-1">25%</div>
                        <div class="text-xs text-white/80 uppercase tracking-wider font-semibold">Target Rent Increase</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm overflow-x-auto hide-scroll no-print">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex space-x-2 sm:space-x-4 min-w-max py-1" aria-label="Tabs">
                    <button onclick="switchTab('general')" class="tab-btn active" id="tab-general">General Info</button>
                    <button onclick="switchTab('model')" class="tab-btn" id="tab-model">Financial Tool</button>
                    <button onclick="switchTab('financial')" class="tab-btn" id="tab-financial">Market Overview</button>
                    <button onclick="switchTab('structure')" class="tab-btn" id="tab-structure">Structure</button>
                    <button onclick="switchTab('steps')" class="tab-btn text-brand-teal font-bold bg-brand-sand/50" id="tab-steps">Execution Plan</button>
                </nav>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            <div id="content-general" class="space-y-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-xl font-bold text-brand-navy mb-2 font-serif">A Rare Find on the Gold Coast</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Sandy Palms is not just a home; it's a 1.4-acre beachfront compound on Hoopers Bay. While the competition is priced near $3M, we have secured a private tender at $1.985M. The asset features a "Bunker" solid concrete structure with zero hurricane claims since 1999.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h4 class="font-serif text-lg font-bold text-brand-navy mb-4">Asset Specifications</h4>
                        <ul class="space-y-3 font-sans text-xs mb-6 text-gray-600">
                            <li class="flex justify-between border-b border-gray-100 pb-2"><span>Land Size</span><span class="font-bold text-brand-navy">1.4 Acres / 100ft Frontage</span></li>
                            <li class="flex justify-between border-b border-gray-100 pb-2"><span>Structure</span><span class="font-bold text-brand-navy">2,778 sq. ft. (Concrete)</span></li>
                            <li class="flex justify-between border-b border-gray-100 pb-2"><span>Units</span><span class="font-bold text-brand-navy">4 Revenue Units</span></li>
                        </ul>
                        <h5 class="text-brand-teal text-[10px] font-bold uppercase tracking-wider mb-3">Market Comparables</h5>
                        <div class="space-y-3">
                            <div class="p-3 bg-brand-sand/40 border border-brand-beige rounded flex justify-between items-start">
                                <div>
                                    <div class="flex items-center gap-2 mb-1"><span class="font-bold text-brand-navy text-sm">Blu Wakes</span> <span class="bg-brand-navy text-white text-[9px] px-1.5 rounded">Neighbor</span></div>
                                    <p class="text-[10px] text-gray-500">New build on Hoopers Bay. 5 Bed / 4 Bath.</p>
                                    <div class="flex gap-2 mt-1 text-[10px] text-brand-teal font-bold"><a href="#">Website ‚Üó</a> <a href="#">For Sale ($5.35M) ‚Üó</a></div>
                                </div>
                            </div>
                            <div class="p-3 bg-white border border-gray-100 rounded flex justify-between items-center">
                                <div><div class="font-bold text-brand-navy text-sm">Vista Del Mar</div><p class="text-[10px] text-gray-500">Oceanfront Estate. 5 Bed / 5 Bath.</p><a href="#" class="text-[10px] text-brand-teal font-bold mt-1 block">View Listing ‚Üó</a></div>
                                <span class="text-xs font-bold text-gray-400">$2.99M</span>
                            </div>
                            <div class="p-3 bg-white border border-gray-100 rounded flex justify-between items-center">
                                <div><div class="font-bold text-brand-navy text-sm">Casa Blanca</div><p class="text-[10px] text-gray-500">Ocean Ridge Estates. 8 Bed / 8 Bath.</p><a href="#" class="text-[10px] text-brand-teal font-bold mt-1 block">View Listing ‚Üó</a></div>
                                <span class="text-xs font-bold text-gray-400">$5.95M</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h4 class="font-serif text-lg font-bold text-brand-navy mb-4">Valuation Gap Analysis</h4>
                        <div class="chart-container" style="height: 300px;"><canvas id="compsChart"></canvas></div>
                    </div>
                </div>

                <div class="text-center max-w-3xl mx-auto py-4">
                    <span class="text-[10px] font-bold text-brand-teal uppercase tracking-widest">The Destination</span>
                    <div class="flex items-center justify-center gap-4 mt-2 mb-4">
                        <h3 class="text-3xl font-serif font-bold text-brand-navy">Great Exuma</h3>
                        <a href="#" class="border border-brand-teal text-brand-teal text-[10px] font-bold px-3 py-1 rounded-full hover:bg-brand-teal hover:text-white transition-colors">View on Map ‚Üó</a>
                    </div>
                    <p class="text-sm text-gray-600 leading-relaxed">This is a very secluded area with high-end properties where tourists are paying premium rates. With new direct airlift from Toronto and Miami, it has become the most accessible "Out Island" experience.</p>
                </div>

                <div class="bg-transparent text-center">
                    <h4 class="font-serif text-xl font-bold text-brand-navy mb-6">The Visual Experience</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-2 rounded-xl shadow-sm border border-gray-100">
                            <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-lg relative overflow-hidden group cursor-pointer"><img src="https://img.youtube.com/vi/nfVZQQlbhyc/mqdefault.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"><div class="absolute inset-0 flex items-center justify-center"><div class="w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white backdrop-blur-sm">‚ñ∂</div></div></div>
                            <p class="text-xs font-bold text-brand-navy mt-2 text-left px-1">The "Money Maker"</p>
                        </div>
                        <div class="bg-white p-2 rounded-xl shadow-sm border border-gray-100">
                            <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-lg relative overflow-hidden group cursor-pointer"><img src="https://img.youtube.com/vi/TV6jBR7R2ZI/mqdefault.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"><div class="absolute inset-0 flex items-center justify-center"><div class="w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white backdrop-blur-sm">‚ñ∂</div></div></div>
                            <p class="text-xs font-bold text-brand-navy mt-2 text-left px-1">Aerial Context</p>
                        </div>
                    </div>
                </div>

                <div class="bg-brand-navy rounded-lg p-8 text-center text-white shadow-lg">
                    <p class="text-sm mb-4 opacity-90">Learn more about the high development standards in the area:</p>
                    <a href="https://www.youtube.com/@buildingwithsteveharbaugh" target="_blank" class="inline-flex items-center gap-2 bg-brand-gold text-brand-navy font-bold px-6 py-2 rounded-full text-sm hover:bg-white transition-colors">‚ñ∂ Steve Harbaugh - Exuma Developer</a>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="font-serif text-lg font-bold text-brand-navy mb-6">Revenue Unit Configuration</h3>
                    <div class="space-y-4">
                        <a href="https://sandypalmsbahamas.com/accom-4bedapart.html" target="_blank" class="block border border-gray-100 rounded-lg p-4 bg-gray-50/50 hover:border-brand-teal transition-colors">
                            <div class="flex items-center gap-2 mb-3"><div class="w-2 h-2 rounded-full bg-brand-teal"></div><span class="font-bold text-brand-navy text-sm">4-Bed Apartment</span><span class="text-xs text-gray-500">- Upper Floor (Sleeps 8)</span><span class="ml-auto text-[10px] text-brand-teal font-bold uppercase">View ‚Üó</span></div>
                            <div class="flex gap-4 text-xs"><div class="flex-1 bg-white border border-gray-200 p-2 rounded flex justify-between"><span class="text-gray-500">Minimum (7 nights)</span><span class="font-bold text-brand-navy">$5,895 / wk</span></div><div class="flex-1 bg-white border border-brand-gold/30 p-2 rounded flex justify-between"><span class="text-gray-500">Dec 18 - Jan 5</span><span class="font-bold text-brand-gold">$6,695 / wk</span></div></div>
                        </a>
                        <a href="https://sandypalmsbahamas.com/accom-1bedapart.html" target="_blank" class="block border border-gray-100 rounded-lg p-4 bg-gray-50/50 hover:border-brand-teal transition-colors">
                            <div class="flex items-center gap-2 mb-3"><div class="w-2 h-2 rounded-full bg-brand-teal"></div><span class="font-bold text-brand-navy text-sm">1-Bed Apartment</span><span class="text-xs text-gray-500">- Ground Floor (Sleeps 4)</span><span class="ml-auto text-[10px] text-brand-teal font-bold uppercase">View ‚Üó</span></div>
                            <div class="flex gap-4 text-xs"><div class="flex-1 bg-white border border-gray-200 p-2 rounded flex justify-between"><span class="text-gray-500">Minimum (7 nights)</span><span class="font-bold text-brand-navy">$2,695 / wk</span></div><div class="flex-1 bg-white border border-brand-gold/30 p-2 rounded flex justify-between"><span class="text-gray-500">Dec 18 - Jan 5</span><span class="font-bold text-brand-gold">$3,095 / wk</span></div></div>
                        </a>
                        <a href="https://sandypalmsbahamas.com/accom-studioapart-queen.html" target="_blank" class="block border border-gray-100 rounded-lg p-4 bg-gray-50/50 hover:border-brand-teal transition-colors">
                            <div class="flex items-center gap-2 mb-3"><div class="w-2 h-2 rounded-full bg-brand-teal"></div><span class="font-bold text-brand-navy text-sm">Queen Studio</span><span class="text-xs text-gray-500">- Ground Floor (Sleeps 2)</span><span class="ml-auto text-[10px] text-brand-teal font-bold uppercase">View ‚Üó</span></div>
                            <div class="flex gap-4 text-xs"><div class="flex-1 bg-white border border-gray-200 p-2 rounded flex justify-between"><span class="text-gray-500">Minimum (7 nights)</span><span class="font-bold text-brand-navy">$1,795 / wk</span></div><div class="flex-1 bg-white border border-brand-gold/30 p-2 rounded flex justify-between"><span class="text-gray-500">Dec 18 - Jan 5</span><span class="font-bold text-brand-gold">$1,995 / wk</span></div></div>
                        </a>
                        <a href="https://sandypalmsbahamas.com/accom-studioapart-king.html" target="_blank" class="block border border-gray-100 rounded-lg p-4 bg-gray-50/50 hover:border-brand-teal transition-colors">
                            <div class="flex items-center gap-2 mb-3"><div class="w-2 h-2 rounded-full bg-brand-teal"></div><span class="font-bold text-brand-navy text-sm">King Studio</span><span class="text-xs text-gray-500">- Ground Floor (Sleeps 2)</span><span class="ml-auto text-[10px] text-brand-teal font-bold uppercase">View ‚Üó</span></div>
                            <div class="flex gap-4 text-xs"><div class="flex-1 bg-white border border-gray-200 p-2 rounded flex justify-between"><span class="text-gray-500">Minimum (7 nights)</span><span class="font-bold text-brand-navy">$1,795 / wk</span></div><div class="flex-1 bg-white border border-brand-gold/30 p-2 rounded flex justify-between"><span class="text-gray-500">Dec 18 - Jan 5</span><span class="font-bold text-brand-gold">$1,995 / wk</span></div></div>
                        </a>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="font-serif text-lg font-bold text-brand-navy mb-4">Logistics & Travel</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-bold text-xs uppercase text-gray-500 mb-3">How to Get There</h4>
                            <ul class="space-y-3 text-xs">
                                <li class="flex gap-3"><span class="text-lg">‚úàÔ∏è</span><div><div class="font-bold text-brand-navy">American Airlines</div><div class="text-gray-500">Miami (1h 10m), Charlotte (2h 25m)</div></div></li>
                                <li class="flex gap-3"><span class="text-lg">‚úàÔ∏è</span><div><div class="font-bold text-brand-navy">Delta Airlines</div><div class="text-gray-500">Atlanta (2h 20m)</div></div></li>
                                <li class="flex gap-3"><span class="text-lg">‚úàÔ∏è</span><div><div class="font-bold text-brand-navy">Air Canada</div><div class="text-gray-500">Toronto (3h 30m)</div></div></li>
                                <li class="flex gap-3"><span class="text-lg">‚úàÔ∏è</span><div><div class="font-bold text-brand-navy">Silver Airways</div><div class="text-gray-500">Fort Lauderdale (1h 30m)</div></div></li>
                            </ul>
                        </div>
                        <div class="bg-brand-sand rounded-xl border border-brand-beige flex flex-col items-center justify-center p-6 text-center">
                            <span class="text-3xl mb-2">üìç</span>
                            <div class="font-bold text-brand-navy text-sm">Location Context</div>
                            <div class="text-xs text-gray-500">15 min drive from GGT Airport.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content-model" class="hidden space-y-10">
                <div class="flex flex-col sm:flex-row justify-between items-center bg-brand-navy p-4 rounded-lg shadow-lg gap-4 no-print font-sans text-white">
                    <div>
                        <h2 class="text-xl font-bold text-brand-gold">Financial Modeling Tool</h2>
                        <p class="text-xs opacity-75">Adjust Income (Left) vs Expenses (Right).</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="fm_toggleCurrency()" id="cur-btn" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded text-xs font-bold transition-colors">VIEW IN CAD ($)</button>
                        <button onclick="generatePDF()" class="bg-brand-gold text-brand-navy px-4 py-2 rounded font-bold text-xs hover:bg-white transition-colors"><span>üìÑ</span> Save PDF</button>
                    </div>
                </div>

                <div id="pdf-capture-area" class="space-y-8">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 border-t-4 border-t-brand-navy">
                            <h4 class="font-bold text-brand-navy mb-6 text-lg font-serif border-b pb-2 flex justify-between">
                                <span>1. Acquisition & Income</span>
                                <span class="text-xs text-gray-400 font-sans" id="lbl-currency-1">USD</span>
                            </h4>
                            <div class="space-y-5">
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Purchase Price</label><input type="number" id="in-price" class="input-clean" value="1985000" onchange="fm_handleInput('in-price')"></div>
                                    <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Buying Costs</label><input type="number" id="in-buying" class="input-clean" value="248125" onchange="fm_handleInput('in-buying')"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Renovation</label><input type="number" id="in-reno" class="input-clean" value="25000" onchange="fm_handleInput('in-reno')"></div>
                                    <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Furn/Other</label><input type="number" id="in-other-cap" class="input-clean" value="25000" onchange="fm_handleInput('in-other-cap')"></div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded border border-gray-200">
                                    <div class="flex justify-between text-xs mb-2"><span class="font-bold text-gray-600">Down Payment</span><span id="disp-down" class="font-bold text-brand-navy">35%</span></div>
                                    <input type="range" id="slider-down" min="20" max="100" step="5" value="35" oninput="fm_handleInput('slider-down')">
                                    <div class="flex justify-between text-xs mb-2 mt-3"><span class="font-bold text-gray-600">Mortgage Rate</span><span id="disp-rate" class="font-bold text-brand-navy">7.0%</span></div>
                                    <input type="range" id="slider-rate" min="3" max="10" step="0.25" value="7" oninput="fm_handleInput('slider-rate')">
                                </div>
                                <div class="pt-4 border-t border-gray-100">
                                    <div class="flex justify-between items-center mb-2"><label class="block text-xs font-bold text-brand-teal uppercase">Gross Potential Revenue</label><input type="number" id="in-gross" class="input-clean w-32 border-brand-teal" value="634734" onchange="fm_handleInput('in-gross')"></div>
                                    <div class="flex justify-between text-xs mb-1"><span class="font-bold text-gray-600">Occupancy Rate</span><span id="disp-occ" class="font-bold text-brand-navy">60%</span></div>
                                    <input type="range" id="slider-occ" min="20" max="90" step="5" value="60" oninput="fm_handleInput('slider-occ')">
                                </div>
                                <div class="bg-brand-sand/50 p-3 rounded flex justify-between items-center"><span class="font-bold text-brand-navy text-sm">Effective Gross Income</span><span id="res-eff-inc" class="font-bold text-brand-teal text-lg"></span></div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 border-t-4 border-t-brand-coral">
                            <h4 class="font-bold text-brand-navy mb-6 text-lg font-serif border-b pb-2 flex justify-between">
                                <span>2. Operating Expenses</span>
                                <span class="text-xs text-gray-400 font-sans" id="lbl-currency-2">USD</span>
                            </h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-center justify-between pb-3 border-b border-gray-100">
                                    <div class="flex flex-col"><label class="font-bold text-gray-700">Property Management</label><div class="flex items-center gap-1"><input type="number" id="in-mgmt-pct" class="w-10 bg-gray-100 text-center border rounded text-xs" value="10" onchange="fm_handleInput('in-mgmt-pct')"><span class="text-xs text-gray-400">% of Revenue</span></div></div>
                                    <span id="res-mgmt-amt" class="font-bold text-gray-500"></span>
                                </div>
                                <div class="grid grid-cols-2 gap-x-6 gap-y-3">
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Utilities</label><input type="number" id="in-util" class="input-clean w-24 text-red-400" value="6000" onchange="fm_handleInput('in-util')"></div>
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Insurance</label><input type="number" id="in-ins" class="input-clean w-24 text-red-400" value="20000" onchange="fm_handleInput('in-ins')"></div>
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Maintenance</label><input type="number" id="in-maint" class="input-clean w-24 text-red-400" value="36000" onchange="fm_handleInput('in-maint')"></div>
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Marketing</label><input type="number" id="in-mktg" class="input-clean w-24 text-red-400" value="2500" onchange="fm_handleInput('in-mktg')"></div>
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Taxes</label><input type="number" id="in-tax" class="input-clean w-24 text-red-400" value="20000" onchange="fm_handleInput('in-tax')"></div>
                                    <div class="flex justify-between items-center"><label class="text-gray-600">Other</label><input type="number" id="in-other-exp" class="input-clean w-24 text-red-400" value="0" onchange="fm_handleInput('in-other-exp')"></div>
                                </div>
                                <div class="mt-6 pt-4 border-t border-gray-200">
                                    <div class="flex justify-between items-center mb-2"><span class="font-bold text-gray-600">Total Operating Expenses</span><span id="res-total-exp" class="font-bold text-red-500"></span></div>
                                    <div class="bg-brand-navy text-white p-3 rounded flex justify-between items-center shadow-md"><span class="font-bold text-sm uppercase tracking-widest text-brand-gold">Net Operating Income</span><span id="res-noi" class="font-bold text-xl text-brand-gold"></span></div>
                                    <div class="flex justify-between items-center mt-2 text-xs text-gray-500 px-1"><span>Annual Debt Service</span><span id="res-debt"></span></div>
                                    <div class="flex justify-between items-center mt-1 text-sm font-bold text-brand-teal px-1"><span>= Net Cash Flow</span><span id="res-ncf"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h4 class="font-bold text-brand-navy mb-4 text-lg font-serif">Future Assumptions & Refinance Strategy</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Income Inflation</label><div class="flex items-center gap-2"><input type="number" id="in-inf-inc" class="input-clean w-16" value="5.0" onchange="fm_handleInput('in-inf-inc')"><span class="text-xs font-bold">%</span></div></div>
                            <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Expense Inflation</label><div class="flex items-center gap-2"><input type="number" id="in-inf-exp" class="input-clean w-16" value="3.0" onchange="fm_handleInput('in-inf-exp')"><span class="text-xs font-bold">%</span></div></div>
                            <div class="bg-brand-teal/5 p-2 rounded -m-2 border border-brand-teal/20"><label class="block text-[10px] font-bold text-brand-teal uppercase mb-1">Refinance LTV %</label><div class="flex items-center gap-2"><input type="number" id="in-refi-ltv" class="input-clean w-16 border-brand-teal text-brand-teal font-bold" value="70" onchange="fm_handleInput('in-refi-ltv')"><span class="text-xs font-bold text-brand-teal">%</span></div></div>
                            <div><label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Selling Costs</label><div class="flex items-center gap-2"><input type="number" id="in-sell-cost" class="input-clean w-16" value="5.0" onchange="fm_handleInput('in-sell-cost')"><span class="text-xs font-bold">%</span></div></div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <h3 class="text-xl font-bold text-brand-navy mb-4 font-serif">30-Year Performance Projection</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full border-collapse text-sm text-center">
                                <thead>
                                    <tr><th class="bg-brand-navy text-white p-3 text-left">Metric</th><th class="bg-brand-navy text-white p-3 text-center">Year 1</th><th class="bg-brand-navy text-white p-3 text-center">Year 2</th><th class="bg-brand-navy text-white p-3 text-center">Year 3</th><th class="bg-brand-navy text-white p-3 text-center">Year 5</th><th class="bg-brand-navy text-white p-3 text-center">Year 10</th><th class="bg-brand-navy text-white p-3 text-center">Year 20</th><th class="bg-brand-navy text-white p-3 text-center">Year 30</th></tr>
                                    <tr class="bg-gray-50 border-b border-gray-200"><td class="p-2 font-bold text-gray-600 italic text-left pl-4">Appreciation Rate</td><td class="p-2"><input type="number" id="app-1" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-1')">%</td><td class="p-2"><input type="number" id="app-2" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-2')">%</td><td class="p-2"><input type="number" id="app-3" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-3')">%</td><td class="p-2"><input type="number" id="app-5" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-5')">%</td><td class="p-2"><input type="number" id="app-10" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-10')">%</td><td class="p-2"><input type="number" id="app-20" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-20')">%</td><td class="p-2"><input type="number" id="app-30" class="table-input-clean mx-auto" value="3.0" onchange="fm_handleInput('app-30')">%</td></tr>
                                </thead>
                                <tbody id="fm-projection-body" class="divide-y divide-gray-100 text-center text-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="content-financial" class="hidden space-y-12">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                    <h4 class="font-bold text-brand-navy mb-4 flex items-center gap-2"><span>üìâ</span> Market Occupancy Reality</h4>
                    <p class="text-sm text-gray-600 mb-4">Market-wide data for Exuma shows ~46% occupancy. However, high-end beachfront estates like Sandy Palms outperform the average.</p>
                    <div class="overflow-x-auto"><table class="min-w-full text-sm text-left"><thead class="bg-brand-sand text-brand-navy"><tr><th class="px-4 py-2">Scenario</th><th class="px-4 py-2">Approx. Occupancy</th></tr></thead><tbody class="divide-y divide-gray-100"><tr><td class="px-4 py-2">Conservative</td><td class="px-4 py-2">~45%</td></tr><tr><td class="px-4 py-2 text-brand-teal">Target</td><td class="px-4 py-2 font-bold text-brand-teal">~60%</td></tr><tr><td class="px-4 py-2">Above-Average</td><td class="px-4 py-2">~65%+</td></tr></tbody></table></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h4 class="font-bold text-brand-navy mb-2">Private Sale Arbitrage</h4><div class="chart-container"><canvas id="arbitrageChart"></canvas></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h4 class="font-bold text-brand-navy mb-2">Financing Strategy</h4><div class="chart-container"><canvas id="financingChart"></canvas></div></div>
                </div>
            </div>

            <div id="content-structure" class="hidden space-y-12">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                    <h3 class="text-2xl font-serif text-brand-navy mb-4">Structure & Exit Strategy (5‚Äì10 Year Horizon)</h3>
                    <p class="text-sm text-gray-600 mb-6">The investment is structured using a General Partner (GP) / Limited Partner (LP) model to clearly separate capital contribution from day-to-day management and decision-making.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-brand-navy p-5 rounded-lg text-white">
                            <h4 class="font-bold text-brand-gold mb-2 text-lg">General Partner (GP)</h4>
                            <p class="text-xs opacity-90 leading-relaxed">Responsible for operations, asset management, financing strategy, and long-term vision.</p>
                        </div>
                        <div class="bg-brand-teal p-5 rounded-lg text-white">
                            <h4 class="font-bold text-white mb-2 text-lg">Limited Partner (LP)</h4>
                            <p class="text-xs opacity-90 leading-relaxed">Participates economically through their equity interest and share in cash flow and appreciation, without operational involvement.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-bold text-brand-navy mb-4 border-b pb-2">Exit Scenarios & Liquidity Options</h4>
                            <div class="space-y-6">
                                <div class="pl-4 border-l-2 border-brand-teal">
                                    <h5 class="text-brand-teal font-bold text-sm">1. Cash-Out Refinance</h5>
                                    <p class="text-xs text-gray-600 mt-1">At any point during the hold period, subject to market conditions, partners may jointly agree to pursue a refinance based on current market valuation.</p>
                                    <ul class="list-disc pl-4 mt-1 text-[10px] text-gray-500"><li>Partial or full return of invested capital</li><li>Continued ownership & participation</li><li>Reinvestment of released equity</li></ul>
                                </div>
                                <div class="pl-4 border-l-2 border-brand-navy">
                                    <h5 class="text-brand-navy font-bold text-sm">2. Market Sale</h5>
                                    <p class="text-xs text-gray-600 mt-1">A full sale of the asset may be pursued if market conditions are favorable and aligned with partner objectives.</p>
                                    <ul class="list-disc pl-4 mt-1 text-[10px] text-gray-500"><li>Market pricing reflects peak valuation</li><li>Risk-adjusted returns justify liquidation</li><li>Net proceeds distributed after debt/fees</li></ul>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col items-center justify-center bg-gray-50 rounded-xl p-4">
                            <h4 class="font-bold text-brand-navy mb-4 text-center text-sm">Total Projected Profit (5 Years)</h4>
                            <div class="relative" style="height: 200px; width: 200px;"><canvas id="totalReturnChart"></canvas></div>
                            <p class="text-[10px] text-gray-400 text-center mt-4">Projected breakdown of returns based on conservative appreciation and steady cash flow.</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3 mb-4"><span class="bg-brand-navy text-white w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">1</span><h4 class="font-bold text-brand-navy">Establishing the Investment Vehicle</h4></div>
                        <p class="text-xs text-gray-600 mb-4">To facilitate ownership, governance, and financing, we will form a corporate entity to hold the Bahamas property.</p>
                        <div class="bg-gray-50 p-3 rounded border border-gray-200 mb-4 text-xs">
                            <span class="block font-bold text-gray-500 mb-1">TYPICAL STRUCTURE</span>
                            <div class="text-brand-navy">üè¢ Parent Holding Corp (Canada) <br> ‚Ü≥ üå¥ Operating Corp (Bahamas) - Owns Property</div>
                        </div>
                        <h5 class="font-bold text-xs text-gray-500 mb-2">KEY BENEFITS</h5>
                        <ul class="list-disc pl-4 text-[10px] text-gray-600 space-y-1"><li>Limited liability protection</li><li>Clear governance with board oversight</li><li>Tax planning flexibility</li><li>Ease of future syndication</li></ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3 mb-4"><span class="bg-brand-navy text-white w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">2</span><h4 class="font-bold text-brand-navy">Partner & Shareholder Framework</h4></div>
                        <p class="text-xs text-gray-600 mb-4">Essential documents to create stability, align incentives, and protect minority shareholders.</p>
                        <ul class="space-y-3 text-xs">
                            <li class="flex gap-2"><span class="text-brand-teal">‚úì</span><div><span class="font-bold block">Shareholders‚Äô Agreement</span><span class="text-gray-500">Clarifies decision thresholds, transfer restrictions.</span></div></li>
                            <li class="flex gap-2"><span class="text-brand-teal">‚úì</span><div><span class="font-bold block">Equity Class Rights</span><span class="text-gray-500">Defines economic rights, voting rights.</span></div></li>
                            <li class="flex gap-2"><span class="text-brand-teal">‚úì</span><div><span class="font-bold block">Exit Mechanisms</span><span class="text-gray-500">Structured pathways for buyouts or sales.</span></div></li>
                        </ul>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                    <h4 class="font-bold text-brand-navy mb-4">Advantages of Registering a Corporation in The Bahamas</h4>
                    <div class="overflow-x-auto"><table class="min-w-full text-xs text-left"><thead class="bg-brand-navy text-white"><tr><th class="p-2 w-1/3">Core Advantage</th><th class="p-2">Strategic Impact & Benefits</th></tr></thead><tbody class="divide-y divide-gray-100"><tr class="hover:bg-brand-sand/30"><td class="p-2 font-bold align-top">1. Legal Ownership</td><td class="p-2 text-gray-600">Simplifies compliance with Bahamian real estate, banking, and regulations. Provides clear legal title.</td></tr><tr class="hover:bg-brand-sand/30"><td class="p-2 font-bold align-top">2. Limited Liability</td><td class="p-2 text-gray-600">Creates legal separation. Limits investor liability strictly to capital contribution.</td></tr><tr class="hover:bg-brand-sand/30"><td class="p-2 font-bold align-top">3. Simplified Structuring</td><td class="p-2 text-gray-600">Easier to define share classes and voting rights. Streamlines adding/removing partners.</td></tr><tr class="hover:bg-brand-sand/30"><td class="p-2 font-bold align-top">4. Access to Financing</td><td class="p-2 text-gray-600">Many lenders prefer/require a locally registered entity. Facilitates security registration.</td></tr><tr class="hover:bg-brand-sand/30 bg-brand-gold/5"><td class="p-2 font-bold align-top">5. Tax Efficiency</td><td class="p-2 text-gray-600">Capitalizes on tax neutrality: No Corp Income Tax, No Capital Gains Tax, No Inheritance Tax.</td></tr></tbody></table></div>
                </div>

                <div class="bg-brand-sand/30 p-6 rounded-xl border border-brand-beige mb-8">
                    <h4 class="font-bold text-brand-navy mb-4 flex items-center gap-2"><span class="bg-brand-navy text-white w-5 h-5 rounded-full flex items-center justify-center text-[10px]">3</span> Cross-Border Banking & Financing Options</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-xs">
                        <div>
                            <h5 class="font-bold text-brand-navy border-b border-gray-300 pb-1 mb-2">üá®üá¶ Canadian Capabilities</h5>
                            <ul class="space-y-2">
                                <li class="flex gap-2 items-center"><div class="font-bold text-brand-navy bg-white border px-1 rounded">CIBC</div><span class="text-gray-600">Commercial real estate financing & asset-based lending.</span></li>
                                <li class="flex gap-2 items-center"><div class="font-bold text-brand-navy bg-white border px-1 rounded">RBC</div><span class="text-gray-600">Leveraging international networks and private banking.</span></li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-bold text-brand-navy border-b border-gray-300 pb-1 mb-2">üáßüá∏ Local Options</h5>
                            <ul class="space-y-2">
                                <li class="flex gap-2 items-center"><div class="font-bold text-brand-teal bg-white border px-1 rounded">FINCO</div><span class="text-gray-600">RBC FINCO: Licensed to provide Bahamian dollar mortgages.</span></li>
                                <li class="flex gap-2 items-center"><div class="font-bold text-brand-teal bg-white border px-1 rounded">CIBC</div><span class="text-gray-600">CIBC Caribbean: Regional footprint for fx and lending.</span></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="bg-brand-navy text-white p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-brand-gold mb-4 text-sm uppercase tracking-wider">4. Recommended Implementation Sequence</h4>
                    <div class="space-y-4 text-xs">
                        <div class="flex gap-4"><div class="w-6 h-6 rounded-full bg-brand-teal flex items-center justify-center font-bold text-white shrink-0">1</div><div><span class="font-bold">Incorporation:</span> Engage legal/tax services to register holding & operating corps.</div></div>
                        <div class="flex gap-4"><div class="w-6 h-6 rounded-full bg-brand-teal flex items-center justify-center font-bold text-white shrink-0">2</div><div><span class="font-bold">Bank Relationships:</span> Introduce concept to CIBC/RBC commercial teams early.</div></div>
                        <div class="flex gap-4"><div class="w-6 h-6 rounded-full bg-brand-teal flex items-center justify-center font-bold text-white shrink-0">3</div><div><span class="font-bold">Draft Agreements:</span> Prepare shareholders‚Äô agreement and bylaws.</div></div>
                        <div class="flex gap-4"><div class="w-6 h-6 rounded-full bg-brand-teal flex items-center justify-center font-bold text-white shrink-0">4</div><div><span class="font-bold">Open Accounts:</span> Establish Canadian and Bahamian corporate bank accounts.</div></div>
                        <div class="flex gap-4"><div class="w-6 h-6 rounded-full bg-brand-teal flex items-center justify-center font-bold text-white shrink-0">5</div><div><span class="font-bold">Finalize & Close:</span> Align debt terms and execute purchase through the structure.</div></div>
                    </div>
                </div>
            </div>

            <div id="content-steps" class="hidden space-y-8">
                <div class="bg-brand-navy text-white p-8 rounded-2xl shadow-xl sticky top-4 z-30 border-b-4 border-brand-gold mb-8">
                    <div class="flex flex-col md:flex-row justify-between items-end gap-4 mb-8">
                        <div><h3 class="text-3xl font-bold text-brand-gold mb-2">Acquisition Master Timeline</h3><p class="text-white/70 text-sm flex items-center gap-4"><span>‚úã Drag cards to reorder</span><span>|</span><span>‚úèÔ∏è Click text to edit</span></p></div>
                        <div class="text-right"><span class="block text-xs uppercase tracking-widest font-bold text-brand-teal mb-1">Current Phase</span><span class="text-3xl font-bold text-white" id="phase-display-title">Phase 1: Pre-Offer</span></div>
                    </div>
                    <div class="relative pt-2 pb-2 px-2"><input type="range" min="1" max="5" value="1" step="1" id="phase-slider" oninput="renderExecutionPlan()" class="z-20 relative"><div class="flex justify-between text-[10px] uppercase font-bold text-white/50 mt-4"><span>1. Prep</span><span>2. The Trip</span><span>3. Offer/Legal</span><span>4. Closing</span><span>5. Launch</span></div></div>
                </div>
                <div id="execution-container"></div>
            </div>

        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm"><p class="mb-2">Sandy Palms Strategic Business Plan v32.0</p><p>Confidential Investment Memorandum.</p></div>
    </footer>

    <script>
        // --- CONSTANTS ---
        const CAD_RATE = 1.43; 
        let fm_isCAD = false;
        const FM_YEARS = [1, 2, 3, 5, 10, 20, 30];
        
        // --- STATE (Updated Defaults) ---
        const defaultState = {
            'in-price': 1985000, 
            'in-buying': 248125, 
            'in-reno': 25000, 
            'in-other-cap': 25000,
            'slider-down': 35, 
            'slider-rate': 7.0,
            
            'in-gross': 634734, 
            'slider-occ': 60,
            'in-mgmt-pct': 10, 
            'in-util': 6000, 
            'in-ins': 20000, 
            'in-maint': 36000, 
            'in-mktg': 2500, 
            'in-tax': 20000, 
            'in-other-exp': 0,
            
            'in-inf-inc': 5.0, 
            'in-inf-exp': 3.0, 
            'in-refi-ltv': 70.0, 
            'in-sell-cost': 5.0,
            'app-1': 3, 'app-2': 3, 'app-3': 3, 'app-5': 3, 'app-10': 3, 'app-20': 3, 'app-30': 3
        };
        let fm_state = { ...defaultState };
        let fm_totalInitialCash = 0; 

        // --- CHARTS & EXECUTION DATA ---
        let compsChart, arbitrageChart, financingChart, totalReturnChart;
        const executionData = {
            1: { title: "Phase 1: Foundation", description: "Getting the money and team ready.", steps: [{ id: 101, title: "Bank Pre-Confirmation", desc: "Secure comfort letter.", date: "" }, { id: 102, title: "Proof of Funds", desc: "Prepare statements.", date: "" }, { id: 103, title: "Engage Bahamian Lawyer", desc: "Must be Bahamas-licensed.", date: "" }, { id: 104, title: "Corp Structure", desc: "Holding Corp setup.", date: "" }] },
            2: { title: "Phase 2: The Trip", description: "On-the-ground due diligence.", steps: [{ id: 201, title: "Site Inspection", desc: "Check seawall integrity.", date: "" }, { id: 202, title: "Meet PMs", desc: "Interview local managers.", date: "" }, { id: 203, title: "Contractor Quotes", desc: "Get reno estimates.", date: "" }, { id: 204, title: "Bank Visit", desc: "Open account.", date: "" }] },
            3: { title: "Phase 3: Offer", description: "Locking down the deal.", steps: [{ id: 301, title: "Submit Offer", desc: "Price: $1.985M.", date: "" }, { id: 302, title: "Inspection", desc: "Engineer report.", date: "" }, { id: 303, title: "Govt Approval", desc: "Apply for Cert.", date: "" }, { id: 304, title: "Appraisal", desc: "Bank valuator.", date: "" }] },
            4: { title: "Phase 4: Closing", description: "Transferring title.", steps: [{ id: 401, title: "Closing Day", desc: "Wire funds.", date: "" }, { id: 402, title: "Reno Kickoff", desc: "Mobilize team.", date: "" }, { id: 403, title: "Staging", desc: "Furniture install.", date: "" }, { id: 404, title: "License", desc: "Hotel Board app.", date: "" }] },
            5: { title: "Phase 5: Launch", description: "Generating revenue.", steps: [{ id: 501, title: "Photos", desc: "Drone shots.", date: "" }, { id: 502, title: "Listing Live", desc: "Airbnb launch.", date: "" }, { id: 503, title: "Optimization", desc: "Pricing adjust.", date: "" }, { id: 504, title: "Distribution", desc: "Q1 Profits.", date: "" }] }
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initFinancialTool();
            initCharts();
            switchTab('general');
        });

        // --- TAB LOGIC ---
        function switchTab(tabId) {
            ['general', 'model', 'financial', 'structure', 'steps'].forEach(id => {
                const c = document.getElementById(`content-${id}`);
                const t = document.getElementById(`tab-${id}`);
                if(c) c.classList.add('hidden');
                if(t) t.classList.remove('active', 'text-brand-navy', 'border-brand-teal', 'font-bold', 'bg-white');
            });
            document.getElementById(`content-${tabId}`).classList.remove('hidden');
            document.getElementById(`tab-${tabId}`).classList.add('active', 'text-brand-navy', 'border-brand-teal', 'font-bold', 'bg-white');
            
            if(tabId === 'steps') renderExecutionPlan();
            if(tabId === 'general' && compsChart) setTimeout(() => compsChart.resize(), 10);
            if(tabId === 'financial') { if(arbitrageChart) arbitrageChart.resize(); if(financingChart) financingChart.resize(); }
            if(tabId === 'structure' && totalReturnChart) totalReturnChart.resize();
        }

        // --- FINANCIAL TOOL ---
        function initFinancialTool() {
            for(const key in fm_state) { const el = document.getElementById(key); if(el) el.value = fm_state[key]; }
            fm_updateCalculations();
        }

        function fm_handleInput(id) {
            const el = document.getElementById(id);
            if(!el) return;
            let val = parseFloat(el.value);
            if(isNaN(val)) val = 0;
            const currencyInputs = ['in-price', 'in-buying', 'in-reno', 'in-other-cap', 'in-gross', 'in-util', 'in-ins', 'in-maint', 'in-mktg', 'in-tax', 'in-other-exp'];
            if(fm_isCAD && currencyInputs.includes(id)) val = val / CAD_RATE;
            fm_state[id] = val;
            fm_updateCalculations();
        }

        function fm_toggleCurrency() {
            fm_isCAD = !fm_isCAD;
            const btn = document.getElementById('cur-btn');
            const lbls = ['lbl-currency-1', 'lbl-currency-2'];
            if(fm_isCAD) {
                btn.innerHTML = "VIEW IN USD ($)";
                btn.classList.add('bg-brand-navy'); btn.classList.remove('bg-white/20');
                lbls.forEach(l => l.innerText = "CAD");
            } else {
                btn.innerHTML = "VIEW IN CAD ($)";
                btn.classList.remove('bg-brand-navy'); btn.classList.add('bg-white/20');
                lbls.forEach(l => l.innerText = "USD");
            }
            const currencyInputs = ['in-price', 'in-buying', 'in-reno', 'in-other-cap', 'in-gross', 'in-util', 'in-ins', 'in-maint', 'in-mktg', 'in-tax', 'in-other-exp'];
            currencyInputs.forEach(id => {
                const el = document.getElementById(id);
                el.value = Math.round(fm_state[id] * (fm_isCAD ? CAD_RATE : 1));
            });
            fm_updateCalculations();
        }

        function fm_updateCalculations() {
            const rate = fm_isCAD ? CAD_RATE : 1;
            const fmt = (v) => (fm_isCAD ? 'C$' : '$') + Math.round(v).toLocaleString();

            const price = fm_state['in-price'] * rate;
            const buying = fm_state['in-buying'] * rate;
            const reno = fm_state['in-reno'] * rate;
            const otherCap = fm_state['in-other-cap'] * rate;
            const downPct = fm_state['slider-down'] / 100;
            document.getElementById('disp-down').innerText = (downPct*100) + '%';
            
            const downAmt = price * downPct;
            const loanAmt = price * (1-downPct);
            const totalCash = downAmt + buying + reno + otherCap;
            fm_totalInitialCash = totalCash;

            const intRate = fm_state['slider-rate'] / 100;
            document.getElementById('disp-rate').innerText = (intRate*100).toFixed(1) + '%';
            const nMonths = 25 * 12;
            const monthlyRate = intRate / 12;
            let monthlyPmt = 0;
            if(loanAmt > 0 && intRate > 0) monthlyPmt = (loanAmt * (monthlyRate * Math.pow(1+monthlyRate, nMonths))) / (Math.pow(1+monthlyRate, nMonths) - 1);
            const annualDebt = monthlyPmt * 12;

            const grossPot = fm_state['in-gross'] * rate;
            const occPct = fm_state['slider-occ'] / 100;
            document.getElementById('disp-occ').innerText = (occPct*100) + '%';
            const effInc = grossPot * occPct;
            document.getElementById('res-eff-inc').innerText = fmt(effInc);

            const mgmtPct = fm_state['in-mgmt-pct'] / 100;
            const mgmtAmt = effInc * mgmtPct;
            document.getElementById('res-mgmt-amt').innerText = fmt(mgmtAmt);

            const fixedExp = (fm_state['in-util'] + fm_state['in-ins'] + fm_state['in-maint'] + fm_state['in-mktg'] + fm_state['in-tax'] + fm_state['in-other-exp']) * rate;
            const totalExp = mgmtAmt + fixedExp;
            document.getElementById('res-total-exp').innerText = fmt(totalExp);

            const noi = effInc - totalExp;
            const ncf = noi - annualDebt;

            document.getElementById('res-noi').innerText = fmt(noi);
            document.getElementById('res-debt').innerText = '(' + fmt(annualDebt) + ')';
            document.getElementById('res-ncf').innerText = fmt(ncf);

            fm_renderProjectionTable(price, loanAmt, totalCash, monthlyRate, nMonths, annualDebt, grossPot, occPct, totalExp, fmt);
        }

        function fm_renderProjectionTable(price, loanAmt, initialCash, mRate, nMonths, debt, gross, occ, startExp, fmt) {
            const body = document.getElementById('fm-projection-body');
            body.innerHTML = '';
            
            const incInf = (fm_state['in-inf-inc'] || 3) / 100;
            const expInf = (fm_state['in-inf-exp'] || 3) / 100;
            const refiLtv = (fm_state['in-refi-ltv'] || 70) / 100;
            const sellCost = (fm_state['in-sell-cost'] || 5) / 100;

            const buildRow = (lbl, vals, bold=false, highlight=false, customColor='') => {
                let cls = highlight ? 'bg-brand-gold/10' : (bold ? 'bg-gray-50' : '');
                let color = customColor ? customColor : (bold ? 'text-brand-navy' : '');
                return `<tr class="${cls}"><td class="p-2 text-left ${bold?'font-bold':''} ${color}">${lbl}</td>${vals.map(v=>`<td class="p-2">${v}</td>`).join('')}</tr>`;
            };

            let r_noi=[], r_cf=[], r_val=[], r_eq=[], r_refi=[], r_prof=[], r_cap=[], r_roi=[];
            let currentVal = price; let lastY = 0;

            FM_YEARS.forEach(y => {
                const gap = y - lastY;
                const app = (fm_state[`app-${y}`] || 3) / 100;
                currentVal = currentVal * Math.pow(1 + app, gap);
                lastY = y;

                const cGross = gross * Math.pow(1+incInf, y-1);
                const cExp = startExp * Math.pow(1+expInf, y-1);
                const cNOI = (cGross * occ) - cExp;
                const cCF = cNOI - debt;
                
                let bal = 0;
                if(loanAmt > 0) bal = loanAmt * (Math.pow(1+mRate, nMonths) - Math.pow(1+mRate, y*12)) / (Math.pow(1+mRate, nMonths) - 1);
                const eq = currentVal - bal;
                const maxRefi = currentVal * refiLtv;
                let cashOut = maxRefi - bal; if (cashOut < 0) cashOut = 0;
                const prof = (eq * (1-sellCost)) + (cCF * y) - initialCash; 
                
                const capRate = currentVal > 0 ? (cNOI / currentVal) * 100 : 0;
                const roiRate = initialCash > 0 ? (cCF / initialCash) * 100 : 0;

                r_noi.push(fmt(cNOI)); r_cf.push(fmt(cCF)); r_val.push(fmt(currentVal)); r_eq.push(fmt(eq)); r_refi.push(fmt(cashOut)); r_prof.push(fmt(prof));
                r_cap.push(capRate.toFixed(1) + '%'); r_roi.push(roiRate.toFixed(1) + '%');
            });

            body.innerHTML += buildRow('Net Operating Income', r_noi);
            body.innerHTML += buildRow('Annual Cash Flow', r_cf, true, false, 'text-green-600');
            body.innerHTML += buildRow('Cap Rate %', r_cap, false, false, 'text-brand-teal');
            body.innerHTML += buildRow('Cash-on-Cash ROI %', r_roi, true);
            body.innerHTML += `<tr><td colspan="8" class="bg-gray-100 text-[10px] font-bold uppercase tracking-widest text-brand-navy p-1 text-left pl-3">Valuation & Exit Strategy</td></tr>`;
            body.innerHTML += buildRow('Projected Value', r_val);
            body.innerHTML += buildRow('Total Equity', r_eq, true);
            body.innerHTML += buildRow('Potential Cash-Out Refi', r_refi, true, false, 'text-brand-teal');
            body.innerHTML += buildRow('Net Profit (Exit)', r_prof, true, true, 'text-brand-navy');
        }

        // --- EXECUTION PLAN (DRAG & DROP) ---
        let dragSrcEl = null, dragSrcIndex = null, currentDragPhase = null;
        function renderExecutionPlan() {
            const container = document.getElementById('execution-container');
            const slider = document.getElementById('phase-slider');
            if(!container || !slider) return;
            const currentPhaseId = parseInt(slider.value);
            const data = executionData[currentPhaseId];
            document.getElementById('phase-display-title').innerText = data.title;
            container.innerHTML = '';
            const phaseWrapper = document.createElement('div'); phaseWrapper.className = "animate-fade-in space-y-6";
            const desc = document.createElement('div'); desc.className = "text-center mb-8"; desc.innerHTML = `<span class="bg-brand-sand text-brand-navy px-6 py-2 rounded-full text-sm font-bold uppercase border border-brand-beige tracking-wide">${data.description}</span>`; phaseWrapper.appendChild(desc);
            const controlsDiv = document.createElement('div'); controlsDiv.className = "flex gap-4 justify-between mb-4";
            const addBtn = document.createElement('button'); addBtn.className = "flex-1 border-2 border-dashed border-gray-300 rounded-xl p-4 text-gray-400 font-bold hover:border-brand-teal hover:text-brand-teal transition-all flex items-center justify-center gap-2"; addBtn.innerHTML = "<span>+</span> Add Step"; addBtn.onclick = () => addStep(currentPhaseId); controlsDiv.appendChild(addBtn); phaseWrapper.appendChild(controlsDiv);
            const grid = document.createElement('div'); grid.className = "grid grid-cols-1 md:grid-cols-2 gap-6";
            data.steps.forEach((step, index) => {
                const card = document.createElement('div'); card.className = "step-card bg-white p-6 rounded-xl shadow-sm border border-gray-100 group"; card.draggable = true;
                card.addEventListener('dragstart', (e) => { dragSrcEl = e.target; dragSrcIndex = index; currentDragPhase = currentPhaseId; e.target.classList.add('dragging'); });
                card.addEventListener('dragover', (e) => { if(e.preventDefault) e.preventDefault(); return false; });
                card.addEventListener('drop', (e) => { if (e.stopPropagation) e.stopPropagation(); if (dragSrcIndex !== index && currentDragPhase === currentPhaseId) { const phaseSteps = executionData[currentPhaseId].steps; const [movedItem] = phaseSteps.splice(dragSrcIndex, 1); phaseSteps.splice(index, 0, movedItem); renderExecutionPlan(); } return false; });
                card.addEventListener('dragend', (e) => { e.target.classList.remove('dragging'); });
                card.innerHTML = `<button onclick="deleteStep(${currentPhaseId}, ${index})" class="delete-btn">√ó</button><div class="flex justify-between items-center mb-3"><div class="flex items-center gap-3"><span class="drag-handle text-gray-300 cursor-grab text-xl">‚ãÆ‚ãÆ</span><span class="bg-brand-navy text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow-sm">${index + 1}</span></div><input type="date" value="${step.date}" onchange="saveDate(${currentPhaseId}, ${index}, this.value)" class="text-xs border border-gray-200 rounded px-2 py-1 text-gray-500"></div><h4 contenteditable="true" class="font-bold text-brand-navy text-lg mb-2 editable-text" onblur="saveStepTitle(${currentPhaseId}, ${index}, this.innerText)">${step.title}</h4><p contenteditable="true" class="text-sm text-gray-600 leading-relaxed editable-text" onblur="saveStepDesc(${currentPhaseId}, ${index}, this.innerText)">${step.desc}</p>`;
                grid.appendChild(card);
            });
            phaseWrapper.appendChild(grid); container.appendChild(phaseWrapper);
        }
        function addStep(pid) { executionData[pid].steps.push({ id: Date.now(), title: "New Action", desc: "Details...", date: "" }); renderExecutionPlan(); }
        function deleteStep(pid, idx) { if(confirm('Delete?')) { executionData[pid].steps.splice(idx, 1); renderExecutionPlan(); } }
        function saveStepTitle(pid, idx, val) { executionData[pid].steps[idx].title = val; }
        function saveStepDesc(pid, idx, val) { executionData[pid].steps[idx].desc = val; }
        function saveDate(pid, idx, val) { executionData[pid].steps[idx].date = val; }

        // --- CHARTS & PDF ---
        function initCharts() {
            if(document.getElementById('compsChart')) new Chart(document.getElementById('compsChart').getContext('2d'), { type: 'bar', data: { labels: ['Sandy Palms', 'Vista Del Mar', 'The Reserve', 'Blu Wakes'], datasets: [{ data: [1.985, 2.99, 2.87, 5.4], backgroundColor: ['#2A9D8F', '#E6E2D6', '#E6E2D6', '#264653'], borderRadius: 4 }] }, options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } } });
            if(document.getElementById('totalReturnChart')) new Chart(document.getElementById('totalReturnChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Appreciation', 'Cash Flow', 'Principal Paydown'], datasets: [{ data: [1500000, 375000, 130000], backgroundColor: ['#2A9D8F', '#E9C46A', '#264653'] }] }, options: { cutout: '60%' } });
            if(document.getElementById('arbitrageChart')) new Chart(document.getElementById('arbitrageChart').getContext('2d'), { type: 'bar', data: { labels: ['Public Listing', 'Private Net Deal'], datasets: [{ label: 'Price', data: [2385000, 1985000], backgroundColor: '#E6E2D6' }, { label: 'Costs', data: [178000, 298500], backgroundColor: '#E76F51' }] }, options: { scales: { x: { stacked: true }, y: { stacked: true } } } });
            if(document.getElementById('financingChart')) new Chart(document.getElementById('financingChart').getContext('2d'), { type: 'bar', data: { labels: ['Bahamas Bank', 'CIBC Int\'l', 'CDN Cash'], datasets: [{ label: 'Monthly Burn Rate ($)', data: [9100, 7900, 5300], backgroundColor: ['#E76F51', '#F4A261', '#2A9D8F'] }] }, options: { responsive: true, plugins: { legend: { display: false } } } });
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('pdf-capture-area');
            const originalBg = element.style.backgroundColor; element.style.backgroundColor = "#ffffff"; 
            try {
                const canvas = await html2canvas(element, { scale: 2 });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                pdf.setFillColor(38, 70, 83); pdf.rect(0, 0, pdfWidth, 25, 'F');
                pdf.setTextColor(255, 255, 255); pdf.setFontSize(20); pdf.text("Sandy Palms Financial Model", 10, 16);
                pdf.addImage(imgData, 'PNG', 0, 30, pdfWidth, pdfHeight);
                pdf.save("SandyPalms_Financial_Model.pdf");
            } catch (err) { alert("Error: " + err.message); } 
            finally { element.style.backgroundColor = originalBg; }
        }
        function exportAllDataCSV() { alert("CSV Export coming soon."); }
    </script>
</body>
</html>